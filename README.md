# Manga Store - Merged Project

## نظرة عامة
تم دمج موقع Manga Store الرئيسي مع لوحة التحكم الإدارية في مشروع واحد موحد. يمكن للمستخدمين العاديين والإداريين الآن تسجيل الدخول من نفس الصفحة والوصول إلى الوظائف المناسبة لهم.

## الميزات الجديدة
- **نظام تسجيل دخول موحد**: يمكن للمستخدمين العاديين والإداريين تسجيل الدخول من نفس الصفحة
- **توجيه تلقائي**: 
  - المستخدمون العاديون يتم توجيههم إلى الصفحة الرئيسية (`/`)
  - الإداريون والمشرفون يتم توجيههم إلى لوحة التحكم (`/admin`)
- **حماية لوحة التحكم**: لوحة التحكم محمية بـ middleware للتحقق من صلاحيات الإدارة

## البنية الجديدة
```
MangaStore/
├── config/
│   ├── firebase-admin.js          # إعدادات Firebase Admin
│   └── manga-store-*-firebase-adminsdk-*.json
├── middlewares/
│   ├── verifyAdmin.js             # middleware للتحقق من صلاحيات الإدارة
│   └── ... (other middlewares)
├── routes/
│   ├── login.js                   # نظام تسجيل الدخول المحدث
│   ├── users.js                   # إدارة المستخدمين (admin)
│   ├── manage-categories.js       # إدارة الفئات والمنتجات (admin)
│   ├── coupon.js                  # إدارة الكوبونات (admin)
│   ├── tickets.js                 # إدارة التذاكر (admin)
│   └── ... (other routes)
├── views/
│   ├── index.ejs                  # لوحة التحكم الرئيسية
│   ├── users.ejs                  # صفحة إدارة المستخدمين
│   ├── products_categories/       # صفحات إدارة المنتجات والفئات
│   ├── coupon/                    # صفحات إدارة الكوبونات
│   ├── tickets/                   # صفحات إدارة التذاكر
│   └── ... (other admin views)
├── templates/
│   ├── RepliedTicketTemplate.js   # قالب الرد على التذاكر
│   └── ... (other email templates)
└── server.js                      # الخادم الرئيسي المحدث
```

## كيفية التشغيل
1. تثبيت التبعيات:
   ```bash
   npm install
   ```

2. تشغيل الخادم:
   ```bash
   npm start
   # أو للتطوير
   npm run dev
   ```

3. الوصول إلى الموقع:
   - الموقع الرئيسي: `http://localhost:3000`
   - صفحة تسجيل الدخول: `http://localhost:3000/login`
   - لوحة التحكم: `http://localhost:3000/admin` (تتطلب صلاحيات إدارية)

## نظام المصادقة
- **المستخدمون العاديون**: يتم توجيههم إلى الصفحة الرئيسية بعد تسجيل الدخول
- **الإداريون والمشرفون**: يتم توجيههم إلى لوحة التحكم بعد تسجيل الدخول
- **الحماية**: لوحة التحكم محمية بـ middleware يتحقق من:
  - وجود session cookie صالح
  - صلاحيات المستخدم (admin أو moderator)
  - بيانات المستخدم في Firebase

## الروابط المهمة
- `/` - الصفحة الرئيسية
- `/login` - صفحة تسجيل الدخول
- `/admin` - لوحة التحكم الرئيسية
- `/admin/manage-categories` - إدارة الفئات والمنتجات
- `/admin/coupons` - إدارة الكوبونات
- `/admin/tickets` - إدارة التذاكر
- `/users` - إدارة المستخدمين

## ملاحظات
- تم دمج جميع ملفات المشروعين بنجاح
- تم إنشاء middleware جديد للتحقق من صلاحيات الإدارة
- تم تحديث نظام تسجيل الدخول للتعامل مع المستخدمين العاديين والإداريين
- جميع routes الإدارية محمية بـ verifyAdmin middleware

